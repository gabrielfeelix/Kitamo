import{d as pe,c,u as ge,h as u,z as be,p as ee,g as r,f as b,a as te,b as w,D as he,E as we,w as j,e as t,i as M,o as i,A as se,l as ae,n as ne,t as p,F as H,r as le,j as xe,G as ye,H as ke,C as Ce}from"./app-f-7kvVxF.js";import{u as Me,_ as _e}from"./useIsMobile-A25L6LBk.js";import{_ as Be,r as J}from"./DesktopShell.vue_vue_type_script_setup_true_lang-CgobhlMn.js";import{_ as De}from"./CreateAccountFlowModal.vue_vue_type_script_setup_true_lang-DJqc9r5g.js";import{_ as $e}from"./CreateCreditCardFlowModal.vue_vue_type_script_setup_true_lang-B9OLonfn.js";import{_ as Se}from"./CreditCardModal.vue_vue_type_script_setup_true_lang-DqL_iXWg.js";import{_ as Ne}from"./MobileToast.vue_vue_type_script_setup_true_lang-zntYyTZN.js";import{_ as Ae}from"./MonthNavigator.vue_vue_type_script_setup_true_lang-CrsHsqcs.js";import{g as Fe,_ as Te}from"./InstitutionAvatar.vue_vue_type_script_setup_true_lang-B7eAQgl8.js";import{T as je,e as Oe}from"./TransactionModal-CO2c7gMo.js";import"./inputGuards-BV9ov3X1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./AccountPickerSheet.vue_vue_type_script_setup_true_lang-DXQ5p_Bz.js";const Pe={class:"flex items-center gap-2"},ze={class:"relative"},Ee={key:0,class:"flex items-center justify-between pt-2"},Re={class:"flex items-center gap-2"},Le={class:"relative"},Ve={class:"mt-6"},Ie={class:"rounded-3xl bg-[#1E293B] p-6 shadow-xl"},Ke={key:0,class:"mt-3 h-10 w-48 animate-pulse rounded-lg bg-white/10"},Ge={key:1,class:"mt-3 text-[32px] font-bold leading-none text-white"},He={key:2,class:"mt-6 grid grid-cols-2 gap-6"},Je={class:"text-[10px] font-semibold uppercase tracking-wide text-[#64748B]"},Ye={key:3,class:"mt-6 grid grid-cols-2 gap-6"},qe={class:"text-[10px] font-semibold uppercase tracking-wide text-[#64748B]"},Ue={class:"mt-1 text-xl font-bold text-white"},We={class:"mt-8 pb-[calc(2rem+env(safe-area-inset-bottom))]"},Qe={class:"flex items-center justify-between"},Xe={key:0,class:"h-4 w-20 animate-pulse rounded bg-slate-200"},Ze={key:1,class:"text-xs font-bold text-emerald-600"},et={key:0,class:"mt-4 space-y-3"},tt={key:1,class:"mt-4 space-y-3"},st={class:"flex items-center gap-3"},at={class:"text-sm font-semibold text-slate-900"},nt={class:"flex flex-wrap items-center gap-1 text-[11px] font-semibold uppercase tracking-wide text-slate-400"},lt={key:0},ot={key:1},it={class:"text-sm font-semibold text-slate-900"},Ct=pe({__name:"Overview",setup(rt){const x=Me(),oe=c(()=>x.value?_e:Be),ie=c(()=>x.value?{showNav:!1}:{title:"Minhas Contas",subtitle:"Resumo",showSearch:!1,showNewAction:!1}),re=ge(),O=c(()=>re.props.bootstrap??{entries:[],goals:[],accounts:[],categories:[],tags:[]}),P=c(()=>{const s=new Date,e=[];for(let a=-120;a<=120;a+=1){const n=new Date(s.getFullYear(),s.getMonth()+a,1),l=new Intl.DateTimeFormat("pt-BR",{month:"short"}).format(n).replace(".","").toUpperCase();e.push({key:`${n.getFullYear()}-${n.getMonth()}`,label:l,date:n})}return e}),m=u(""),f=u(new Map),z=u(new Map),y=u(new Map),_=u(new Map);be(()=>{const s=`${new Date().getFullYear()}-${new Date().getMonth()}`;m.value=P.value.find(e=>e.key===s)?.key??P.value[0]?.key??""}),ee(m,s=>{s&&E(s)},{immediate:!0});const k=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2,maximumFractionDigits:2}).format(s),ue=c(()=>{const s=new Map;for(const e of O.value.categories??[]){const a=e.type==="income"?"income":e.type==="expense"?"expense":void 0,n=s.get(e.name),l=n?.kind&&a&&n.kind!==a?void 0:n?.kind??a;s.set(e.name,{key:e.name,label:e.name,icon:e.icon??"other",tone:"slate",customColor:e.color??void 0,kind:l})}return Array.from(s.values())}),de=c(()=>{const s=e=>{const a=e.toLowerCase();return a.includes("nubank")?"purple":a.includes("inter")?"amber":a.includes("carteira")||a.includes("dinheiro")?"emerald":"slate"};return(O.value.accounts??[]).filter(e=>e.type!=="credit_card").map(e=>({key:e.name,label:e.name,subtitle:e.type==="wallet"?"Carteira":"Conta",tone:s(e.name),type:e.type,balance:Number(e.current_balance??0),customColor:e.color??void 0,icon:e.icon??void 0}))}),B=u(!1),Y=u("transfer"),q=u(null),U=()=>{Y.value="transfer",q.value=null,B.value=!0},ce=async s=>{if(s.kind==="transfer")try{await Oe(s),C("Transferência realizada"),B.value=!1,m.value&&E(m.value)}catch{C("Não foi possível realizar a transferência")}},E=async s=>{const e=s,a=`cards-${s}`;f.value.delete(e),f.value.delete(a),z.value.delete(e),_.value.delete(e),y.value.set(s,!0);try{const[n,l]=s.split("-").map(Number),[o,v]=await Promise.all([J(`/api/contas-by-month?year=${n}&month=${l}`,{method:"GET"}),J(`/api/cartoes-by-month?year=${n}&month=${l}`,{method:"GET"})]),h=o?.accounts??o?.contas??[];f.value.set(e,Array.isArray(h)?h:[]);const F=String(o?.mode??"");F&&z.value.set(e,F);const T=Number(o?.balanco??NaN);Number.isFinite(T)&&_.value.set(e,T);const d=v?.cartoes??v?.cards??[];f.value.set(a,Array.isArray(d)?d:[])}catch(n){console.error("Failed to load accounts for month",n),f.value.set(e,[]),f.value.set(a,[]),_.value.set(e,0)}finally{y.value.set(s,!1)}},W=c(()=>{const s=m.value;return!s||y.value.get(s)?[]:f.value.has(s)?(f.value.get(s)??[]).filter(n=>(n.type??n.tipo)!=="credit_card").map(n=>{const l=n.type??n.tipo,o=n.institution??null,v=n.svgPath??null,h=o??n.name??n.nome??null;return{id:n.id,name:n.name??n.nome,subtitle:n.subtitle??n.subtitulo??(l==="wallet"?"Dinheiro físico":l==="bank"?"Corrente":"Conta"),balance:Number(n.current_balance??n.saldo_atual??n.saldo??0),color:n.color??n.cor??"#14B8A6",icon:n.icon??n.icone??(l==="wallet"?"wallet":"bank"),hasData:!!(n.has_data??!0),balanceKind:String(n.balance_kind??""),institution:o,svgPath:v??Fe(h)}}):[]}),Q=c(()=>{const s=m.value,e=`cards-${s}`;return!s||y.value.get(s)?[]:f.value.has(e)?(f.value.get(e)??[]).map(l=>({id:l.id,name:l.name??l.nome,balance:Math.max(0,Number(l.limite_usado??l.current_balance??0)),limit:Number(l.limite??l.credit_limit??0),color:l.cor??l.color??"#8B5CF6",brand:l.bandeira??l.card_brand??"visa",closingDay:Number(l.dia_fechamento??l.closing_day??0)||null,dueDay:Number(l.dia_vencimento??l.due_day??0)||null})):[]});c(()=>{const s=l=>String(l??"").trim().toLowerCase(),e=new Map;for(const l of Q.value){const o=s(l.name),v=e.get(o)??[];v.push(l),e.set(o,v)}const a=[];for(const[l,o]of e.entries()){if(o.length===1){a.push({...o[0],displayName:o[0].name});continue}const v=[...o].sort((d,G)=>String(d.id).localeCompare(String(G.id))),h=new Set(v.map(d=>String(d.brand??"").toLowerCase())).size>1,F=new Set(v.map(d=>d.dueDay??null)).size>1,T=new Set(v.map(d=>d.closingDay??null)).size>1;v.forEach((d,G)=>{const fe=h||F||T?d.name:`${d.name} (${G+1})`;a.push({...d,displayName:fe})})}const n=new Map(Q.value.map((l,o)=>[String(l.id),o]));return a.sort((l,o)=>(n.get(String(l.id))??0)-(n.get(String(o.id))??0))});const R=c(()=>W.value.reduce((s,e)=>s+e.balance,0)),L=c(()=>{const s=m.value;return s?_.value.get(s)??0:0}),X=c(()=>D.value==="past"?"Final do mês":D.value==="future"?"Saldo previsto":"Saldo atual"),D=c(()=>{const s=m.value;return s?String(z.value.get(s)??""):""}),$=c(()=>{const s=m.value;return s?y.value.get(s)??!1:!1}),V=u(!1),Z=u(""),C=s=>{Z.value=s,V.value=!0},S=u(!1),N=u(!1),I=u(!1),K=u(!1),g=u(!1),A=s=>{g.value=!1,s==="bank"?(N.value=!1,S.value=!0):s==="wallet"?(N.value=!0,S.value=!0):s==="card"&&(K.value=!0)},me=()=>{window.location.reload()},ve=async s=>{try{await J("/api/cartoes",{method:"POST",body:JSON.stringify({...s,icone:"credit-card"})}),C("Cartão adicionado com sucesso!"),I.value=!1,window.location.reload()}catch{C("Não foi possível adicionar o cartão")}};return ee(()=>m.value,s=>{s&&E(s)}),(s,e)=>(i(),r(H,null,[b(w(he),{title:"Minhas Contas"}),(i(),te(Ce(oe.value),ye(ke(ie.value)),we({default:j(()=>[w(x)?(i(),r("header",Ee,[b(w(ae),{href:s.route("dashboard"),class:"flex h-10 w-10 items-center justify-center rounded-2xl bg-white text-slate-600 shadow-sm ring-1 ring-slate-200/60","aria-label":"Voltar"},{default:j(()=>[...e[18]||(e[18]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M15 18l-6-6 6-6"})],-1)])]),_:1},8,["href"]),e[21]||(e[21]=t("div",{class:"text-center"},[t("div",{class:"text-lg font-semibold text-slate-900"},"Minhas Contas")],-1)),t("div",Re,[t("button",{type:"button",class:"flex h-10 w-10 items-center justify-center rounded-2xl bg-white text-slate-600 shadow-sm ring-1 ring-slate-200/60","aria-label":"Transferência",onClick:U},[...e[19]||(e[19]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M4 8h11"}),t("path",{d:"M12 5l3 3-3 3"}),t("path",{d:"M20 16H9"}),t("path",{d:"M12 13l-3 3 3 3"})],-1)])]),t("div",Le,[t("button",{type:"button",class:"flex h-10 w-10 items-center justify-center rounded-2xl bg-white text-slate-600 shadow-sm ring-1 ring-slate-200/60","aria-label":"Menu",onClick:e[5]||(e[5]=a=>g.value=!g.value)},[...e[20]||(e[20]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor"},[t("circle",{cx:"12",cy:"5",r:"2"}),t("circle",{cx:"12",cy:"12",r:"2"}),t("circle",{cx:"12",cy:"19",r:"2"})],-1)])]),g.value?(i(),r("div",{key:0,class:"fixed inset-0 z-[65]",onClick:e[9]||(e[9]=a=>g.value=!1)},[t("div",{class:"absolute right-5 top-16 w-56 overflow-hidden rounded-2xl bg-white shadow-2xl ring-1 ring-slate-200/70",onClick:e[8]||(e[8]=se(()=>{},["stop"]))},[t("button",{type:"button",class:"w-full text-left rounded-t-2xl border-b border-slate-100 px-4 py-3 text-sm font-semibold text-slate-900 hover:bg-slate-50",onClick:e[6]||(e[6]=a=>A("bank"))}," Adicionar Conta Bancária "),t("button",{type:"button",class:"w-full text-left rounded-b-2xl px-4 py-3 text-sm font-semibold text-slate-900 hover:bg-slate-50",onClick:e[7]||(e[7]=a=>A("wallet"))}," Criar Carteira ")])])):M("",!0)])])])):M("",!0),t("div",Ve,[b(Ae,{modelValue:m.value,"onUpdate:modelValue":e[10]||(e[10]=a=>m.value=a),months:P.value},null,8,["modelValue","months"])]),t("div",{class:ne(["mt-6",w(x)?"px-6":""])},[t("div",Ie,[e[25]||(e[25]=t("div",{class:"flex items-start justify-between"},[t("div",{class:"text-[10px] font-semibold uppercase tracking-wider text-[#64748B]"}," Saldo consolidado "),t("div",{class:"flex h-6 w-6 items-center justify-center"},[t("svg",{class:"h-4 w-4 text-white/30",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),t("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),t("line",{x1:"3",y1:"18",x2:"21",y2:"18"})])])],-1)),$.value?(i(),r("div",Ke)):(i(),r("div",Ge,p(k(R.value)),1)),$.value?(i(),r("div",He,[t("div",null,[t("div",Je,p(X.value),1),e[22]||(e[22]=t("div",{class:"mt-1 h-7 w-32 animate-pulse rounded bg-white/10"},null,-1))]),e[23]||(e[23]=t("div",null,[t("div",{class:"text-[10px] font-semibold uppercase tracking-wide text-[#64748B]"}," Balanço mensal "),t("div",{class:"mt-1 h-7 w-32 animate-pulse rounded bg-white/10"})],-1))])):(i(),r("div",Ye,[t("div",null,[t("div",qe,p(X.value),1),t("div",Ue,p(k(R.value)),1)]),t("div",null,[e[24]||(e[24]=t("div",{class:"text-[10px] font-semibold uppercase tracking-wide text-[#64748B]"}," Balanço mensal ",-1)),t("div",{class:ne(["mt-1 text-xl font-bold",L.value>=0?"text-[#14B8A6]":"text-[#EF4444]"])},p(L.value>=0?"+":"-")+" "+p(k(Math.abs(L.value))),3)])]))])],2),t("section",We,[t("div",Qe,[e[26]||(e[26]=t("div",{class:"text-xs font-bold uppercase tracking-wide text-slate-400"},"Contas e carteiras",-1)),$.value?(i(),r("div",Xe)):(i(),r("div",Ze,p(k(R.value)),1))]),$.value?(i(),r("div",et,[(i(),r(H,null,le(3,a=>t("div",{key:a,class:"flex items-center justify-between rounded-3xl bg-white px-4 py-4 shadow-sm ring-1 ring-slate-200/60"},[...e[27]||(e[27]=[t("div",{class:"flex items-center gap-3"},[t("div",{class:"h-12 w-12 animate-pulse rounded-2xl bg-slate-200"}),t("div",null,[t("div",{class:"h-4 w-32 animate-pulse rounded bg-slate-200"}),t("div",{class:"mt-1 h-3 w-24 animate-pulse rounded bg-slate-100"})])],-1),t("div",{class:"h-4 w-20 animate-pulse rounded bg-slate-200"},null,-1)])])),64))])):(i(),r("div",tt,[(i(!0),r(H,null,le(W.value,a=>(i(),te(w(ae),{key:a.id,href:s.route("accounts.show",{accountKey:a.id}),class:"flex items-center justify-between rounded-3xl bg-white px-4 py-4 shadow-sm ring-1 ring-slate-200/60"},{default:j(()=>[t("div",st,[b(Te,{institution:a.institution??a.name,"svg-path":a.svgPath,"is-wallet":a.icon==="wallet","fallback-icon":a.icon==="wallet"?"wallet":"account","container-class":"flex h-12 w-12 items-center justify-center overflow-hidden rounded-2xl bg-white","img-class":"h-10 w-10 object-contain","fallback-bg-class":"rounded-2xl text-white","fallback-icon-class":"h-5 w-5",style:xe(a.svgPath?void 0:{backgroundColor:a.color})},null,8,["institution","svg-path","is-wallet","fallback-icon","style"]),t("div",null,[t("div",at,p(a.name),1),t("div",nt,[t("span",null,p(a.subtitle),1),D.value==="past"&&a.hasData===!1?(i(),r("span",lt,"(SEM DADOS)")):M("",!0),D.value==="future"?(i(),r("span",ot,"(PROJEÇÃO)")):M("",!0)])])]),t("div",it,p(k(a.balance)),1)]),_:2},1032,["href"]))),128))]))]),b(Ne,{show:V.value,message:Z.value,onDismiss:e[11]||(e[11]=a=>V.value=!1)},null,8,["show","message"]),b(De,{open:S.value,"start-with-wallet":N.value,onClose:e[12]||(e[12]=()=>{S.value=!1,N.value=!1}),onToast:C},null,8,["open","start-with-wallet"]),b($e,{open:K.value,onClose:e[13]||(e[13]=a=>K.value=!1),onSave:me},null,8,["open"]),b(Se,{open:I.value,onClose:e[14]||(e[14]=a=>I.value=!1),onSave:ve},null,8,["open"]),b(je,{open:B.value,kind:Y.value,initial:q.value,categories:ue.value,accounts:de.value,tags:O.value.tags,onClose:e[15]||(e[15]=a=>B.value=!1),onSave:ce},null,8,["open","kind","initial","categories","accounts","tags"])]),_:2},[w(x)?void 0:{name:"headerActions",fn:j(()=>[t("div",Pe,[t("button",{type:"button",class:"flex h-11 w-11 items-center justify-center rounded-2xl bg-white text-slate-600 ring-1 ring-slate-200/60","aria-label":"Transferência",onClick:U},[...e[16]||(e[16]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M4 8h11"}),t("path",{d:"M12 5l3 3-3 3"}),t("path",{d:"M20 16H9"}),t("path",{d:"M12 13l-3 3 3 3"})],-1)])]),t("div",ze,[t("button",{type:"button",class:"flex h-11 w-11 items-center justify-center rounded-2xl bg-white text-slate-600 ring-1 ring-slate-200/60","aria-label":"Menu",onClick:e[0]||(e[0]=a=>g.value=!g.value)},[...e[17]||(e[17]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor"},[t("circle",{cx:"12",cy:"5",r:"2"}),t("circle",{cx:"12",cy:"12",r:"2"}),t("circle",{cx:"12",cy:"19",r:"2"})],-1)])]),g.value?(i(),r("div",{key:0,class:"fixed inset-0 z-[65]",onClick:e[4]||(e[4]=a=>g.value=!1)},[t("div",{class:"absolute right-5 top-16 w-56 overflow-hidden rounded-2xl bg-white shadow-2xl ring-1 ring-slate-200/70",onClick:e[3]||(e[3]=se(()=>{},["stop"]))},[t("button",{type:"button",class:"w-full rounded-t-2xl border-b border-slate-100 px-4 py-3 text-left text-sm font-semibold text-slate-900 hover:bg-slate-50",onClick:e[1]||(e[1]=a=>A("bank"))}," Adicionar Conta Bancária "),t("button",{type:"button",class:"w-full rounded-b-2xl px-4 py-3 text-left text-sm font-semibold text-slate-900 hover:bg-slate-50",onClick:e[2]||(e[2]=a=>A("wallet"))}," Criar Carteira ")])])):M("",!0)])])]),key:"0"}]),1040))],64))}});export{Ct as default};
